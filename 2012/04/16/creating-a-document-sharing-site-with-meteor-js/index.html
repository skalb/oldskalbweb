
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
<<<<<<< HEAD
  <title>Creating a Document Sharing Site With Meteor.js - skalb.com</title>
  <meta name="author" content="Sameer Kalburgi">

  
  <meta name="description" content="Background: “Meteor is a set of new technologies for building top-quality web apps in a fraction of the time, whether you&rsquo;re an expert &hellip;">
  
=======
  <title>Creating a document sharing site with Meteor.js - skalb.com</title>
  <meta name="author" content="Sameer Kalburgi">

   
  <meta name="description" content="">
  
  <meta name="keywords" content="">
>>>>>>> e8a7200851be11b9841409b7bfa3f7f2d19c6c71

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
<<<<<<< HEAD
  <link rel="canonical" href="http://www.skalb.com/2012/04/16/creating-a-document-sharing-site-with-meteor-js/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/skalb" rel="alternate" title="skalb.com" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
=======
  <link rel="canonical" href="http://www.skalb.com/2012/04/16/creating-a-document-sharing-site-with-meteor-js">
  <link href="/favicon.png" rel="icon">
  <link href='http://fonts.googleapis.com/css?family=Quicksand:300,400' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="http://feeds.feedburner.com/skalb" rel="alternate" title="skalb.com" type="application/atom+xml">
  <script src="/js/jquery.js"></script>
  <script src="/js/bootstrap-collapse.js"></script>
  <script src="/js/modernizr-2.0.js"></script>
  <script src="/js/octopress.js" type="text/javascript"></script>
  <script src="/js/application.js"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
>>>>>>> e8a7200851be11b9841409b7bfa3f7f2d19c6c71

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19284849-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
<<<<<<< HEAD
  <header role="banner"><hgroup>
  <h1><a href="/">skalb.com</a></h1>
  
    <h2>By Sameer Kalburgi.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="http://feeds.feedburner.com/skalb" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="www.skalb.com">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Creating a Document Sharing Site With Meteor.js</h1>
    
    
      <p class="meta">
        
=======
  <div class="navbar navbar-inverse navbar-static-top">
  	<div class="navbar-inner">
  	  <div class="container">
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".navbar-responsive-collapse">
          <span class="fui-menu-24"></span>
        </a>
  	  	<div class="nav-collapse collapse navbar-responsive-collapse" style="height:0;">
  	      <ul class="nav">
    
        <li ><a href="/index.html">skalb.com</a></li>
    
        <li ><a href="/blog/archives/index.html">Archives</a></li>
    
        <li ><a href="https://github.com/skalb/skalb.github.com/tree/source">Source</a></li>
    
</ul>

<ul class="nav pull-right">
    
    <li><a href="http://github.com/skalb" title="Github Profile"><i class="icon-github-sign social-navbar"></i></a></li>
    
    
    
    <li><a href="http://linkedin.com/in/sameerkalburgi" title="Linkedin Profile"><i class="icon-linkedin-sign social-navbar"></i></a></li>
    
    
    <li><a href="http://twitter.com/sameerkalburgi" title="Twitter Profile"><i class="icon-twitter-sign social-navbar"></i></a></li>
    
    
    <li><a href="http://plus.google.com/100596472903145614776" title="Google+ Profile"><i class="icon-google-plus-sign social-navbar"></i></a></li>
    
    
    

    
</ul>

  	    </div>
  	  </div>
  	</div>
  </div>
  <div class="container" id="main">
      <div class="row-fluid">
        <div id="content">
          <div>
<article class="hentry" role="article">
  

  <header>
  <div class="jumbotron">
    Creating a Document Sharing Site With Meteor.js
	<h5>


>>>>>>> e8a7200851be11b9841409b7bfa3f7f2d19c6c71




<<<<<<< HEAD
<time class='entry-date' datetime='2012-04-16T00:00:00-07:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:00 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p><strong>Background:</strong></p>

<p>“Meteor is a set of new technologies for building top-quality web apps in a fraction of the time, whether you&rsquo;re an expert developer or just getting started.”
- <a href="http://www.meteor.com">Meteor.com</a></p>
=======


  


<i class="icon-calendar-empty"></i> <time datetime="2012-04-16T00:00:00-07:00" pubdate data-updated="true">Apr 16<span>th</span>, 2012</time></h5>
  </div>
</header>
  <div class="row-fluid">
    <div class="span12">
      <p><strong>Background:</strong></p>

<p>“Meteor is a set of new technologies for building top-quality web apps in a fraction of the time, whether you&rsquo;re an expert developer or just getting started.”
&ndash; <a href="http://www.meteor.com">Meteor.com</a></p>
>>>>>>> e8a7200851be11b9841409b7bfa3f7f2d19c6c71

<p><strong>Goal:</strong></p>

<p>Create and deploy a real time document sharing website. The final product is at: <a href="http://docshare-tutorial.meteor.com">docshare-tutorial.meteor.com</a>.</p>

<!--more-->


<p><strong>Updated: Source code at <a href="https://github.com/skalb/docshare-tutorial">https://github.com/skalb/docshare-tutorial</a></strong></p>

<p><strong>Spec:</strong></p>

<ul>
<li>Single page app with two sections</li>
<li>Section 1

<ul>
<li>List of documents each with edit and delete buttons</li>
<li>Create new document button with name input</li>
</ul>
</li>
<li>Section 2

<ul>
<li>Text area of the document currently being edited</li>
</ul>
</li>
</ul>


<p><strong>Prerequisites:</strong></p>

<ul>
<li>Install Meteor</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<<<<<<< HEAD
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl install.meteor.com <span class="p">|</span> /bin/sh
=======
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>curl install.meteor.com | /bin/sh
>>>>>>> e8a7200851be11b9841409b7bfa3f7f2d19c6c71
</span></code></pre></td></tr></table></div></figure>


<p><strong>Step 1: Getting things started</strong></p>

<p>Lets create the app:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>meteor create docshare-tutorial
</span></code></pre></td></tr></table></div></figure>


<p>Now, start the meteor server:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>docshare-tutorial
</span><span class='line'>meteor
</span></code></pre></td></tr></table></div></figure>


<p>You should see the default site at <a href="http://localhost:3000/">http://localhost:3000</a>:</p>

<p>Lastly, add the other packages we are going to use</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>meteor add coffeescript
</span><span class='line'>meteor add backbone
</span></code></pre></td></tr></table></div></figure>


<p><strong>Step 2: Setting up the project</strong></p>

<p>Go ahead and delete <strong>docshare-tutorial.js</strong> and empty out the contents of <strong>docshare-tutorial.html</strong>.</p>

<p>Meteor lets you separate client and server code in 2 different ways:</p>

<ol>
<li>Using the Meteor.is_client and Meteor.is_server flags</li>
<li>Place client and server Javascript in the /client and /server folders, respectively. Any Javascript at the root level with run on both.</li>
</ol>


<p>I prefer method 2 since it feels a bit cleaner to me, but feel free to instead combine everything into one file. Create <strong>docshare-tutorial.coffee</strong>  at the root and <strong>client.coffee</strong>  in /client folder and <strong>server.coffee</strong> in the /server folder.</p>

<p><strong>Step 3: Server</strong></p>

<p>Collections in Meteor are schemaless. We want our documents collection to be available to both the server and the client so we’ll add it to the root level.</p>

<figure class='code'><figcaption><span>docshare-tutorial.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'> <span class="vi">@Documents = </span><span class="k">new</span> <span class="nx">Meteor</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(</span><span class="s">&quot;documents&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Our document object will have two fields: name and text. Let’s create a sample document on startup.</p>

<figure class='code'><figcaption><span>server.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nx">Meteor</span><span class="p">.</span><span class="nx">startup</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">Documents</span><span class="p">.</span><span class="nx">find</span><span class="p">().</span><span class="nx">count</span><span class="p">()</span> <span class="o">is</span> <span class="mi">0</span>
</span><span class='line'>    <span class="nx">Documents</span><span class="p">.</span><span class="nx">insert</span>
</span><span class='line'>      <span class="nv">name: </span><span class="s">&quot;Sample doc&quot;</span>
</span><span class='line'>      <span class="nv">text: </span><span class="s">&quot;Write here...&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, if you restart the meteor server, you’ll be able to access that document in the browser. Try this in the developer console:</p>

<figure class='code'><figcaption><span>console</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">Documents</span><span class="p">.</span><span class="nx">findOne</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>You will see an object with the properties we just created. This is the only time you should need to restart the meteor server.</p>

<p><strong>Step 4: Client HTML</strong></p>

<p>Here’s we’ll define our head and body. The body will render two templates: documentList and documentView.</p>

<figure class='code'><figcaption><span>console</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">docshare</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/head&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p"></span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">hr</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p"></span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/body&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next, create the two templates needed to display the documents: documentList and document.</p>

<figure class='code'><figcaption><span>console</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">template</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;documentList&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Welcome</span> <span class="nx">to</span> <span class="nb">document</span> <span class="nx">sharing</span><span class="o">!&lt;</span><span class="err">/h1&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="p"></span>
</span><span class='line'>      <span class="p"></span>
</span><span class='line'>    <span class="p"></span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;createDocument&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="nx">Name</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;new-document-name&quot;</span> <span class="nx">placeholder</span><span class="o">=</span><span class="s2">&quot;New document&quot;</span> <span class="o">/&gt;&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;button&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;new-document&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;create&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we are using the built in Handlebars iterator #each to render the individual document objects. Finally, there’s a input field and create button to add a new document.</p>

<p>Now add the template to list the documents names each with an edit and delete button. We’ll also use a template method to determine which document is selected.</p>

<figure class='code'><figcaption><span>console</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">template</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">div</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&quot;document &quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="p"></span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;button&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;edit-document&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Edit&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;button&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;delete-document&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Delete&quot;</span><span class="o">/&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>   <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Lastly, let’s add the actual text field that the users can edit.</p>

<figure class='code'><figcaption><span>console</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">template</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;documentView&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="p"></span>
</span><span class='line'>  <span class="p"></span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">div</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="p"></span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">textarea</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;document-text&quot;</span> <span class="nx">rows</span><span class="o">=</span><span class="s2">&quot;10&quot;</span> <span class="nx">cols</span><span class="o">=</span><span class="s2">&quot;80&quot;</span><span class="o">&gt;</span><span class="p"></span><span class="o">&lt;</span><span class="err">/textarea&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span><span class='line'>   <span class="p"></span>
</span><span class='line'>   <span class="p"></span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/template&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that this will only be rendered if a document is currently selected. Having both an #if and a #with seems redundant, but I didn’t see a better way. Based off the Handlebars documentation, I should only need the #if, but that doesn’t work.</p>

<p><strong>Step 5: Client Coffeescript</strong></p>

<p>First, we’ll setup a Backbone router to allow us to keep track of which document we’re viewing. This will allow us to support page refreshes and permalinking to documents.</p>

<figure class='code'><figcaption><span>client.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">DocumentsRouter = </span><span class="nx">Backbone</span><span class="p">.</span><span class="nx">Router</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span>
</span><span class='line'>  <span class="nv">routes:</span>
</span><span class='line'>    <span class="s">&quot;:document_id&quot;</span><span class="o">:</span> <span class="s">&quot;main&quot;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">main: </span><span class="nf">(document_id) -&gt;</span>
</span><span class='line'>    <span class="nx">Session</span><span class="p">.</span><span class="nx">set</span> <span class="s">&quot;document_id&quot;</span><span class="p">,</span> <span class="nx">document_id</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">setDocument: </span><span class="nf">(document_id) -&gt;</span>
</span><span class='line'>    <span class="nx">@navigate</span><span class="p">(</span><span class="nx">document_id</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Router = </span><span class="k">new</span> <span class="nx">DocumentsRouter</span>
</span><span class='line'>
</span><span class='line'><span class="nx">Meteor</span><span class="p">.</span><span class="nx">startup</span> <span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">Backbone</span><span class="p">.</span><span class="nx">history</span><span class="p">.</span><span class="nx">start</span> <span class="nv">pushState: </span><span class="kc">true</span>
</span></code></pre></td></tr></table></div></figure>


<p>Basically this will store the document_id into the Meteor session whenever the user navigates to a URL or form /:document_id. If you’re not familar with Backbone, don’t worry about this, or read up at <a href="http://backbonejs.org/">http://backbonejs.org/</a></p>

<p>We are also using Meteor.startup again here but for a different purpose. On the client side it will run after DOM is loaded every time. I think it would be more clear if this method didn’t mean different things based on context.</p>

<p>Next, we need to define where the documentList template gets its data and handle the create new button</p>

<figure class='code'><figcaption><span>client.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">Template.documentList.documents = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nx">Documents</span><span class="p">.</span><span class="nx">find</span><span class="p">({},</span>
</span><span class='line'>    <span class="nv">sort:</span>
</span><span class='line'>      <span class="nv">name: </span><span class="mi">1</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Template.documentList.events =</span>
</span><span class='line'>  <span class="s">&#39;click #new-document&#39;</span><span class="o">:</span> <span class="nf">(e) -&gt;</span>
</span><span class='line'>    <span class="nv">name = </span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#new-document-name&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
</span><span class='line'>    <span class="k">if</span> <span class="nx">name</span>
</span><span class='line'>      <span class="nx">Documents</span><span class="p">.</span><span class="nx">insert</span><span class="p">(</span>
</span><span class='line'>        <span class="nv">name: </span><span class="nx">name</span>
</span><span class='line'>        <span class="nv">text: </span><span class="s">&quot;&quot;</span>
</span><span class='line'>      <span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice that we’re sorting the documents by name. Each time a new document is added it will be correctly injected into the DOM. The entire list is not recreated. There is also a bit of validation to make sure the name exists.</p>

<p>Documents.insert (and all collection operations) are non-blocking when called client side. Meteor will go ahead and insert the data to the local client and can optionally call a callback with an object identifier or error message after the real operation finishes. This is invisible to the user, of course.</p>

<p>Next, define the selected property and event handlers for edit and delete:</p>

<figure class='code'><figcaption><span>client.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">Template.document.events =</span>
</span><span class='line'>  <span class="s">&#39;click #delete-document&#39;</span><span class="o">:</span> <span class="nf">(e) -&gt;</span>
</span><span class='line'>    <span class="nx">Documents</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="nx">@_id</span><span class="p">)</span>
</span><span class='line'>  <span class="s">&#39;click #edit-document&#39;</span><span class="o">:</span> <span class="nf">(e) -&gt;</span>
</span><span class='line'>    <span class="nx">Router</span><span class="p">.</span><span class="nx">setDocument</span><span class="p">(</span><span class="nx">@_id</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Template.document.selected = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="k">if</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">equals</span><span class="p">(</span><span class="s">&quot;document_id&quot;</span><span class="p">,</span> <span class="nx">@_id</span><span class="p">)</span> <span class="k">then</span> <span class="s">&quot;selected&quot;</span> <span class="k">else</span> <span class="s">&quot;&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that in handlers for events the this object is the actual Document object.</p>

<p>Next, define the selectedDocument using the id stored in the session and update the text of that document when the user presses a key.</p>

<figure class='code'><figcaption><span>client.coffee</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='coffeescript'><span class='line'><span class="nv">Template.documentView.selectedDocument = </span><span class="nf">-&gt;</span>
</span><span class='line'>  <span class="nv">document_id = </span><span class="nx">Session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;document_id&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">Documents</span><span class="p">.</span><span class="nx">findOne</span><span class="p">(</span>
</span><span class='line'>    <span class="nv">_id: </span><span class="nx">document_id</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nv">Template.documentView.events =</span>
</span><span class='line'>  <span class="s">&#39;keyup #document-text&#39;</span><span class="o">:</span> <span class="nf">(e) -&gt;</span>
</span><span class='line'>    <span class="c1"># @_id should work here, but it doesn&#39;t</span>
</span><span class='line'>    <span class="nv">sel = _id: </span><span class="nx">Session</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s">&quot;document_id&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="nv">mod = $set: text: </span><span class="nx">$</span><span class="p">(</span><span class="s">&#39;#document-text&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">()</span>
</span><span class='line'>    <span class="nx">Documents</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">sel</span><span class="p">,</span> <span class="nx">mod</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Meteor acknowledges in their docs: “For now, the event handler gets the template data from the top level of the current template, not the template data from the template context of the element that triggered the event. This will be changing.” This is why we have to pull the id from the session.</p>

<p>Lastly, add the css style for the selected div:</p>

<figure class='code'><figcaption><span>docshare-tutorial.css</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='css'><span class='line'><span class="nc">.selected</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">background-color</span><span class="o">:</span> <span class="nb">yellow</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>Conclusion:</strong>
That’s it, done! 50 lines of HTML and 50 lines of Coffeescript for a very basic Google docs clone.</p>

<p>To test it out open two browsers and type!</p>
<<<<<<< HEAD
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Sameer Kalburgi</span></span>

      




<time class='entry-date' datetime='2012-04-16T00:00:00-07:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>16</span><span class='date-suffix'>th</span>, <span class='date-year'>2012</span></span> <span class='time'>12:00 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/categories/backbone/'>backbone</a>, <a class='category' href='/categories/coffeescript/'>coffeescript</a>, <a class='category' href='/categories/meteor/'>meteor</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://www.skalb.com/2012/04/16/creating-a-document-sharing-site-with-meteor-js/" data-via="sameerkalburgi" data-counturl="http://www.skalb.com/2012/04/16/creating-a-document-sharing-site-with-meteor-js/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
      
        <a class="basic-alignment right" href="/2012/04/23/how-to-easily-handle-model-relationships-in-rails-and-backbone-js/" title="Next Post: How to (easily) handle model relationships in Rails and Backbone.js">How to (easily) handle model relationships in Rails and Backbone.js &raquo;</a>
      
    </p>
=======

    </div>
  </div>



  <footer>
    <hr>
    
    <div class="row-fluid">
      
      <div class="span6">
        <p class="meta">
        
        



  <a href="/categories/backbone/"><span class="badge">Backbone</span></a>

  <a href="/categories/coffeescript/"><span class="badge">CoffeeScript</span></a>

  <a href="/categories/meteor/"><span class="badge">Meteor</span></a>




        </p>
      </div>
      
      <div class="span6 social-sharing">
        <div class="sharing">
  <div class="addthis_toolbox addthis_default_style ">
  
  <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
  
  
  <a class="addthis_button_tweet"></a>
  
  
  <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
  
  <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>

      </div>
      
      
    </div>
    
    <div class="row-fluid">
      <div class="span12">
        <p class="meta">
          
          
            <a class="basic-alignment right" href="/2012/04/23/how-to-easily-handle-model-relationships-in-rails-and-backbone-js/" title="Next Post: How to (easily) handle model relationships in Rails and Backbone.js">How to (easily) handle model relationships in Rails and Backbone.js &raquo;</a>
          
        </p>
      </div>
    </div>
>>>>>>> e8a7200851be11b9841409b7bfa3f7f2d19c6c71
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<<<<<<< HEAD
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2013/07/04/simpleshop-pure-javascript-photo-editing/">Simpleshop: Pure JavaScript Photo Editing</a>
      </li>
    
      <li class="post">
        <a href="/2013/04/23/server-side-auto-complete-using-nodejs/">Server Side Airport Autocomplete Using NodeJS</a>
      </li>
    
      <li class="post">
        <a href="/2013/01/20/multi-color-heat-map-in-javascript/">Multi-color Heat Map in JavaScript</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/25/using-sinon-spys-with-meteor-collections/">Using Sinon Spys With Meteor Collections</a>
      </li>
    
      <li class="post">
        <a href="/2012/08/20/testing-backbone-routers-in-meteor-with-mocha/">Testing Backbone Routers in Meteor With Mocha</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/skalb">@skalb</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'skalb',
            count: 5,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>



<section class="googleplus">
  <h1>
    <a href="https://plus.google.com/100596472903145614776?rel=author">
      <img src="http://www.google.com/images/icons/ui/gprofile_button-32.png" width="32" height="32">
      Google+
    </a>
  </h1>
</section>



  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Sameer Kalburgi -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
=======


        </div>
      </div>
      <div class="row-fluid">
        <footer class="footer-page" role="contentinfo">
          <p>
  Copyright &copy; 2014 - Sameer Kalburgi -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span> - Theme by <a href="http://alexgaribay.com">Alex Garibay</a>
</p>


        </footer>
      </div>
  </div>
>>>>>>> e8a7200851be11b9841409b7bfa3f7f2d19c6c71
  

<script type="text/javascript">
      var disqus_shortname = 'skalb';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.skalb.com/2012/04/16/creating-a-document-sharing-site-with-meteor-js/';
        var disqus_url = 'http://www.skalb.com/2012/04/16/creating-a-document-sharing-site-with-meteor-js/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
<<<<<<< HEAD
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
=======
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
>>>>>>> e8a7200851be11b9841409b7bfa3f7f2d19c6c71
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
<<<<<<< HEAD
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
=======
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
>>>>>>> e8a7200851be11b9841409b7bfa3f7f2d19c6c71
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
